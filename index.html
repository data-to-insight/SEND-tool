<!DOCTYPE html>
<html>
<head>
   <meta charset="UTF-8">
   <meta http-equiv="X-UA-Compatible" content="IE=edge">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
   <link type="text/css", rel="stylesheet" href="style.css" /> 
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
   <script src="https://cdn.jsdelivr.net/pyodide/v0.20.0/full/pyodide.js"></script>
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.21/jquery.csv.min.js"></script>
   <script src="https://cdn.plot.ly/plotly-2.1.0.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.1.5/purify.js" integrity="sha512-H+0buHbolflDvyVXCBa2dGPlz8aDXXQ1ynVFKEsz5rZolkJ9kuxqoNkmt7Yxzw6pZmvGO0wKx0jQsikSkqccXg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.js" integrity="sha512-zPMZ/3MBK+R1rv6KcBFcf7rGwLnKS+xtB2OnWkAxgC6anqxlDhl/wMWtDbiYI4rgi/NrCJdXrmNGB8pIq+slJQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
   <script src="main.js" type="text/javascript"></script>
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-dark bg-dark d-print-none">
    <div class="container">
      <a class="navbar-brand" href="#">SEND Analysis Tool</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="./index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="about/about.html">About</a>
          </li>
          <!-- <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="./index.html" role="button" data-bs-toggle="dropdown" aria-expanded="false">
              About
            </a>
            <li class="nav-item">
              <a class="nav-link" href="about/about.html">About</a>
            </li>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="about/instructions.html">Instructions for using the tool</a></li>
              <li><a class="dropdown-item" href="about/description.html">About the tool</a></li>
            </ul>
          </li> -->
        </ul>
        <li><a class="navbar-brand ms-auto" href="#">Data to Insight
          <img src="./images/d2i_logo.png" alt="Logo" width="20" height="auto" class="d-inline-block align-text-top">
        </a></li>
      </div>
    </div>
  </nav>
    </div>
    </div>
    <section class="container">
      <div class="m-3 p-5 bg-white text-black rounded py-5 px-2" id="intro_text">
        <p>
          This tool provides visualisations based on SEND data held by local authorities 
          (LAs) in the standard format of the “SEN2” special educational needs survey. Until 
          recently, the “SEN2” data was produced by LAs as aggregate data. The survey is now a
          client-level survey, meaning that a standard client-level dataset is available 
          for analysis by LAs. 
        </p>
        <p>
          To get started, use the tool below to point at your local SEN2 CSVs (excel uploads are currently not supported, 
          descriptions of file structure can be found on the 'About' page), select a reference date, and click 'Submit'. You can 
          then view the visualisations in your browser, or produce a PDF output. Give the tool
          some time to run as the calculations and plot rendering is a little intensive. NOTE: if using a smaller
          screen, you may need to zoom out of the page (normally ctrl + the minus button) until the plots align properly,
          this is necessary for the PDF to correctly render, too.
          Detailed instructions and further info can be found on the About page.  
        </p>
        <p>
          This tool works in much the same way as other Data to Insight web tools; when you use 
          the tool, no data leaves your local network. For more information on how this works, 
          please see our <a href="https://www.datatoinsight.org/patch#:~:text=read/write%20permissions.-,How%20it%20works">detailed guide</a>. 
          More information about how to contribute feedback, 
          or access our learning resources, can be found <a href="https://www.datatoinsight.org/patch">here</a>.
        </p>
        <p>
          You can view and contribute to the source code for this tool <a href="https://github.com/data-to-insight/SEND-tool">here</a>.
        </p>
    </div>
    <div class="d-none" id="long_text">
      <p>
        This report provides visualisations based on SEND data held by local authorities 
        (LAs) in the standard format of the “SEN2” special educational needs survey. Until 
        recently, the “SEN2” data was produced by LAs as aggregate data. The survey is now a
        client-level survey, meaning that a standard client-level dataset is available 
        for analysis by LAs. 
      </p>
      <p>
        You can visit the tool in browser https://data-to-insight.github.io/SEND-tool/
        You can view and contribute to the source code for this tool https://github.com/data-to-insight/SEND-tool
      </p>
    </div>
    </section>
    <section class="container" >
      <div class="m-3 p-5 bg-white text-black rounded py-5 px-2">
      <div class="d-print-none">
        <div class="row  justify-content-center row-cols-1 g-2 g-lg-3 py-2 px-2">
          <div class="col">
          </div>
            <form id="myForm">
              <h1>Select files and reference date</h1>
              
              <div class="row" >
                <div class="col">
                  <input type="file" id="csvFile" accept=".csv, .xlsx" class="form-control" multiple/>
                </div>
                <div class="col">
                  <input id="refDate" class="form-control" type="date" />
                </div>
              </div>
             <div class="row py-2 px-2">
              <input type="submit" value="Submit" class="btn btn-primary"></input>
             </div>
              
              <div class="row py-2 m-2">
                <div id="submitSpinner" class="spinner d-none" >
                  <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                  Loading...
                </div> 
              </div>
            </form>
            
          </div>
      <div class="row py-2 px-2">
        <button id="print" type="button" class="btn btn-primary d-none" onclick="pdfFunction()">Save to pdf</button>
        </div>
        <div class="row py-2 m-2">
          <div id="pdfSpinner" class="spinner d-none" >
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
            Loading...
          </div> 
        </div>

      <!-- <button id="print" type="button" class="btn btn-primary d-none" onclick="pdfFunction()">Save to pdf</button> -->
      </div>
    </section>

    <section id="totals" class="container">
    <div class="row  justify-content-center row-cols-1 g-2 g-lg-3 py-2 px-2" style="min-width: 2480">
      <h1 id="total_header" class="m-3 p-5 bg-white text-black rounded d-none">Total cohort breakdown</h1>
    </div>  
      <div class="row  justify-content-center row-cols-2 g-2 g-lg-3 py-2">
        <div class="col">
          <div  id="total_count"></div>
        </div> 
        <div class="col">
          <div id="total_gender"></div>
        </div>
      </div>
      <div class="row  justify-content-center py-2">
        <div class="img-fluid" id="total_ethnicity"></div>
      </div>
      <div class="row justify-content-center row-cols-2 g-2 g-lg-3 py-2">
        <div class="col">
          <div class="col"></div>
          <div  id="total_age"></div>
          <div class="col"></div>
        </div>
      </div>
    </section>

    <section id="ehcs_ceased" class="container">
      <div class="row  justify-content-center row-cols-1 g-2 g-lg-3 py-2 px-2">
        <h1 id="ehc_ceased_header" class="m-3 p-5 bg-white text-black rounded d-none">
          EHCs ceased within the past year
        </h1>
      </div>    
      <div class="row justify-content-center row-cols-2 g-2 g-lg-3 py-2">
        <div class="col">
          <div id="ehc_ceased"></div> 
        </div>
        <div class="col">
            <div id="ehc_ceased_gender"></div> 
        </div>  
      </div>
      <div class="row justify-content-center py-2">
        <div id="ehc_ceased_ethnicity"></div> 
      </div>
      <div class="row justify-content-center row-cols-2 g-2 g-lg-3 py-2">
        <div class="col">
          <div id="ehc_ceased_age"></div>
        </div>
        <div class="col">
          <div id="ehc_ceased_reason"></div>  
        </div>
      </div>
    </section>

    <section id="ehcs_started" class="container">
      <div class="row  justify-content-center row-cols-1 g-2 g-lg-3 py-2 px-2">
        <h1 id="ehc_started_header" class="m-3 p-5 bg-white text-black rounded d-none">
          EHCs started within the past year
        </h1>
      </div>   
      <div class="row row-cols-2 g-2 g-lg-3 py-2">
        <div class="col">
          <div id="ehc_started"></div> 
        </div> 
        <div class="col">
          <div id="ehc_started_gender"></div>
        </div>
      </div>
      <div class="row justify-content-center py-2">
        <div class="col">
          <div id="ehc_started_ethnicity"></div> 
        </div>
        <div class="row justify-content-center row-cols-2 g-2 g-lg-3 py-2">
          <div class="col">
            <div class="col"></div>
            <div  id="ehc_started_age"></div>
            <div class="col"></div>
          </div>
      </div>
    </section>

    <section id="assessments_completed" class="container">
      <div class="row justify-content-center row-cols-1 g-2 g-lg-3 py-2 px-2">
        <h1 id="ass_completed_header" class="m-3 p-5 bg-white text-black rounded d-none">
          Assessments completed within the past year
        </h1>
      </div>     
      <div class="row justify-content-center row-cols-2 g-2 g-lg-3 py-2">
        <div class="col">
          <div id="ass_completed"></div> 
        </div>
        <div class="col">
            <div id="ass_completed_gender"></div> 
        </div>  
      </div>
      <div class="row justify-content-center py-2">
        <div id="ass_completed_ethnicity"></div> 
      </div>
      <div class="row justify-content-center row-cols-2 g-2 g-lg-3 py-2">
        <div class="col">
          <div id="ass_completed_age"></div>
        </div>
        <div class="col">
          <div id="ass_completed_reason"></div>  
        </div>
      </div>
    </section>
           


    <section id="assessments_closed_timeframes" class="container">
      <div class="row justify-content-center row-cols-1 g-2 g-lg-3 py-2 px-2">
        <h1 id="ass_closed_timeframe_header" class="m-3 p-5 bg-white text-black rounded d-none">
          Completed assessment timeliness
        </h1>
      </div> 
      <div class="row  justify-content-center row-cols-2 g-2 g-lg-3 py-2">
        <div class="col">
          <div  id="ass_closed_timeframe_gender"></div>
        </div> 
        <div class="col">
          <div id="ass_closed_timeframe_age"></div>
        </div>
      </div>
      <div class="row  justify-content-center py-2">
        <div class="img-fluid" id="ass_closed_timeframe_ethnicity"></div>
      </div>
    </section>
        
    <section id="open_assessment_timeframes" class="container">
      <div class="row justify-content-center row-cols-1 g-2 g-lg-3 py-2 px-2">
        <h1 id="open_ass_timeframe_header" class="m-3 p-5 bg-white text-black rounded d-none">
          Currently open assessment timeframes
        </h1>
      </div>   
      <div class="row row-cols-2 g-2 g-lg-3 py-2">
        <div class="col">
          <div id="open_ass"></div> 
        </div> 
        <div class="col">
          <div id="open_ass_gender"></div>
        </div>
      </div>
      <div class="row justify-content-center py-2">
        <div class="col">
          <div id="open_ass_ethnicity"></div> 
        </div>
        <div class="row justify-content-center row-cols-2 g-2 g-lg-3 py-2">
          <div class="col">
            <div class="col"></div>
            <div  id="open_ass_age"></div>
            <div class="col"></div>
          </div>
      </div>
    </section>


    <section id="requests_year" class="container">
      <div class="row  justify-content-center row-cols-1 g-2 g-lg-3 py-2 px-2">
        <h1 id="request_header" class="m-3 p-5 bg-white text-black rounded d-none">
          Request in the past year
        </h1>
      </div>  
        <div class="row  justify-content-center row-cols-2 g-2 g-lg-3 py-2">
          <div class="col">
            <div  id="req_count"></div>
          </div> 
          <div class="col">
            <div id="req_gender"></div>
          </div>
        </div>
        <div class="row  justify-content-center py-2">
          <div class="img-fluid" id="req_ethnicity"></div>
        </div>
        <div class="row justify-content-center row-cols-2 g-2 g-lg-3 py-2">
          <div class="col">
            <div class="col"></div>
            <div  id="req_age"></div>
            <div class="col"></div>
          </div>
        </div>
    </section>


    <section id="multiples_and_journeys" class="container">
      <div class="row  justify-content-center row-cols-1 g-2 g-lg-3 py-2 px-2">
        <h1 id="multiple_appearances_header" class="m-3 p-5 bg-white text-black rounded d-none">
          Children appearing in lists multiple times
        </h1>
      </div>  
      <div class="row justify-content-center row-cols-2 g-2 g-lg-3 py-2">
        <div class="col"><div id="multiples_m2_div"></div></div>
        <div class="col"><div id="multiples_m3_div"></div></div>
      </div>
      <div class="row  justify-content-center row-cols-1 g-2 g-lg-3 py-2 px-2">
        <h1 id="journeys_header" class="m-3 p-5 bg-white text-black rounded d-none">
          Outcomes from requests journeys
        </h1>
      </div>
      <div class="row justify-content-center py-2">
        <div id="journeys_div"></div>
      </div>
    </section>

    <section id="open_plan_lengths" class="container">
      <div class="row  justify-content-center row-cols-1 g-2 g-lg-3 py-2 px-2">
        <h1 id="open_plan_length_header" class="m-3 p-5 bg-white text-black rounded d-none">
          Open plan lengths
        </h1>  
      </div>
      <div class="row row-cols-2 g-2 g-lg-3 py-2">
        <div class="col">
          <div id="open_plan_length_gender"></div>
        </div>
        <div class="col">
          <div id="open_plan_length_age"></div>  
        </div>
      </div>
      <div class="row justify-content-center py-2">
        <div id="open_plan_length_ethnicity"></div> 
      </div>

    </section> 
    <section id="closed_plan_lengths" class="container">
      <div class="row  justify-content-center row-cols-1 g-2 g-lg-3 py-2 px-2">
        <h1 id="closed_plan_length_header" class="m-3 p-5 bg-white text-black rounded d-none">
          Closed plan lengths
        </h1>  
      </div>
      <div class="row row-cols-2 g-2 g-lg-3 py-2">
        <div class="col">
          <div id="closed_plan_length_gender"></div>
        </div>
        <div class="col">
          <div id="closed_plan_length_age"></div>  
        </div>
      </div>
      <div class="row justify-content-center py-2">
        <div id="closed_plan_length_ethnicity"></div> 
      </div>
    </section> 
            
                
        
      </div>
        
   <script>
      window.jsPDF = window.jspdf.jsPDF;
      const version_number = "0.0.1"

      const myForm = document.getElementById("myForm");
      const csvFile = document.getElementById("csvFile");

      let refDate = document.getElementById('refDate')
      
      var refDateVal = refDate.addEventListener('change',(e)=>{
        refDateVal = e.target.value
        console.log(refDateVal)
        return refDateVal
      })
      
      myForm.addEventListener("submit", function (e) {
         e.preventDefault();

         $("#submitSpinner").removeClass('d-none');
         
        run_analysis();
        
      });
    </script>
    <script>
      window.jsPDF = window.jspdf.jsPDF;
      document.long_text = document.getElementById("long_text")

      function pdfFunction(){
          window.alert('Generating PDF, this may take some time.')

          var doc = new jsPDF('a4', 'in');
          var pageGap = 10;
          doc.setFont('helvetica')
          doc.setFontSize(40)
          doc.setTextColor(220,220,220)


          // title card
          doc.setFillColor(33,37,41);
          doc.rect(0, 3, 8.7, 2, 'F');

          doc.text(
                'SEND analysis tool', 1.75, 3.75)

          doc.setFontSize(8)      
          let version = "Version number: "
          let version_text = version.concat(version_number)
          doc.text(
            version_text, 1.75, 3.9) 
          
          doc.setFontSize(20)
          let refDateText = "Reference date: "
          let fullRefDate = refDateText.concat(refDateVal)
          doc.text(
            fullRefDate, 1.75, 4.25
          )
            
          
          // Logo + d2i description
          var img = new Image()
          img.src = 'images/d2i_logo.png'
          var d2i_logo = new Image()
          d2i_logo.src = 'images/DTI full png.png'
          doc.addImage( d2i_logo, 'png', 6.6, 0.3, 1.2, 1, "0", "SLOW")  
                      
          doc.setFontSize(12)

          doc.text("Data to Insight is a national project commissioned by the ADCS,", 0.5, 0.9)
          doc.text("DfE and Ofsted to help local authorities make better use of data.", 0.5, 1.1)

  
          // long text
          doc.setTextColor(0, 0, 0)
          textlines = doc.setFont('helvetica')
          
          .splitTextToSize(document.long_text.innerText, 7.25);
  
          let verticalOffset = 6
          doc.text(0.5, verticalOffset + 12 / 72, textlines)
          verticalOffset += (textlines.length + 0.5) * 12 / 72

          doc.addPage()  
          var totals  
          html2canvas(document.getElementById("totals"), {scale: 2})
          .then(function (canvas) {
            $("#pdfSpinner").removeClass('d-none');
            doc.setFillColor(33,37,41);
            doc.rect(0, 0, 8.7, 11.7, 'F');
            doc.addImage(img, 'png', 0.5, 0.15, 0.175, 0.35, "1", 'SLOW') 
            doc.setFontSize(12)
            doc.setTextColor(255, 255, 255)
            doc.text("Data to Insight: SEND analysis tool", 5.5, 0.4)
            doc.text(version_number, 4.3, 4)
            
            totals = canvas.toDataURL("image/png")
            const imgProps= doc.getImageProperties(totals);
            const pdfWidth = doc.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            doc.addImage(totals, 'PNG', 0, 0.75, pdfWidth, pdfHeight, "2", 'SLOW');
            doc.addPage("a4")
            });

          var ehcs_ceased  
          html2canvas(document.getElementById("ehcs_ceased"), {scale: 2})
          .then(function (canvas) {
            doc.setFillColor(33,37,41);
            doc.rect(0, 0, 8.7, 11.7, 'F');
            doc.addImage(img, 'png', 0.5, 0.15, 0.175, 0.35, "3", 'SLOW') 
            doc.setFontSize(12)
            doc.setTextColor(255, 255, 255)
            doc.text("Data to Insight: SEND analysis tool", 5.5, 0.4)

            ehcs_ceased = canvas.toDataURL("image/png")
            const imgProps= doc.getImageProperties(ehcs_ceased);
            const pdfWidth = doc.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            doc.addImage(ehcs_ceased, 'PNG', 0, 0.75, pdfWidth, pdfHeight, "4", 'SLOW');
            doc.addPage("a4")
            });

         var ehcs_started 
          html2canvas(document.getElementById("ehcs_started"), {scale: 2})
          .then(function (canvas) {
            doc.setFillColor(33,37,41);
            doc.rect(0, 0, 8.7, 11.7, 'F');
            doc.addImage(img, 'png', 0.5, 0.15, 0.175, 0.35, "5", 'SLOW') 
            doc.setFontSize(12)
            doc.setTextColor(255, 255, 255)
            doc.text("Data to Insight: SEND analysis tool", 5.5, 0.4)

            ehcs_started = canvas.toDataURL("image/png")
            const imgProps= doc.getImageProperties(ehcs_started);
            const pdfWidth = doc.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            doc.addImage(ehcs_started, 'PNG', 0, 0.75, pdfWidth, pdfHeight, "6", 'SLOW');
            // doc.save("plots.pdf");
            doc.addPage("a4")
            });  

          var assessments_completed 
          html2canvas(document.getElementById("assessments_completed"), {scale: 2})
          .then(function (canvas) {
            doc.setFillColor(33,37,41);
            doc.rect(0, 0, 8.7, 11.7, 'F');
            doc.addImage(img, 'png', 0.5, 0.15, 0.175, 0.35, "7", 'SLOW') 
            doc.setFontSize(12)
            doc.setTextColor(255, 255, 255)
            doc.text("Data to Insight: SEND analysis tool", 5.5, 0.4)

            assessments_completed = canvas.toDataURL("image/png")
            const imgProps= doc.getImageProperties(assessments_completed);
            const pdfWidth = doc.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            doc.addImage(assessments_completed, 'PNG', 0, 0.75, pdfWidth, pdfHeight, "8", 'SLOW');
            doc.addPage("a4")
            });  

          var completed_assessment_timelinness 
          html2canvas(document.getElementById("assessments_closed_timeframes"), {scale: 2})
          .then(function (canvas) {
            doc.setFillColor(33,37,41);
            doc.rect(0, 0, 8.7, 11.7, 'F');
            doc.addImage(img, 'png', 0.5, 0.15, 0.175, 0.35, "9", 'SLOW') 
            doc.setFontSize(12)
            doc.setTextColor(255, 255, 255)
            doc.text("Data to Insight: SEND analysis tool", 5.5, 0.4)

            completed_assessment_timelinness = canvas.toDataURL("image/png")
            const imgProps= doc.getImageProperties(completed_assessment_timelinness);
            const pdfWidth = doc.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            doc.addImage(completed_assessment_timelinness, 'PNG', 0, 0.75, pdfWidth, pdfHeight, "10", 'SLOW');
            doc.addPage("a4")
            });  
          
          var open_assessment_timelinness 
          html2canvas(document.getElementById("open_assessment_timeframes"), {scale: 2})
          .then(function (canvas) {
            doc.setFillColor(33,37,41);
            doc.rect(0, 0, 8.7, 11.7, 'F');
            doc.addImage(img, 'png', 0.5, 0.15, 0.175, 0.35, "11", 'SLOW') 
            doc.setFontSize(12)
            doc.setTextColor(255, 255, 255)
            doc.text("Data to Insight: SEND analysis tool", 5.5, 0.4)

            open_assessment_timelinness  = canvas.toDataURL("image/png")
            const imgProps= doc.getImageProperties(open_assessment_timelinness );
            const pdfWidth = doc.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            doc.addImage(open_assessment_timelinness , 'PNG', 0, 0.75, pdfWidth, pdfHeight, "12", 'SLOW');
            doc.addPage("a4")
            });              

          var requests_year 
          html2canvas(document.getElementById("requests_year"), {scale: 2})
          .then(function (canvas) {
            doc.setFillColor(33,37,41);
            doc.rect(0, 0, 8.7, 11.7, 'F');
            doc.addImage(img, 'png', 0.5, 0.15, 0.175, 0.35, "13", 'SLOW') 
            doc.setFontSize(12)
            doc.setTextColor(255, 255, 255)
            doc.text("Data to Insight: SEND analysis tool", 5.5, 0.4)

            requests_year = canvas.toDataURL("image/png")
            const imgProps= doc.getImageProperties(requests_year);
            const pdfWidth = doc.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            doc.addImage(requests_year, 'PNG', 0, 0.75, pdfWidth, pdfHeight, "14", 'SLOW');
            doc.addPage("a4")
            });  
          
          var multiples_and_journeys 
          html2canvas(document.getElementById("multiples_and_journeys"), {scale: 2})
          .then(function (canvas) {
            doc.setFillColor(33,37,41);
            doc.rect(0, 0, 8.7, 11.7, 'F');
            doc.addImage(img, 'png', 0.5, 0.15, 0.175, 0.35, "15", 'SLOW') 
            doc.setFontSize(12)
            doc.setTextColor(255, 255, 255)
            doc.text("Data to Insight: SEND analysis tool", 5.5, 0.4)

            multiples_and_journeys = canvas.toDataURL("image/png")
            const imgProps= doc.getImageProperties(multiples_and_journeys);
            const pdfWidth = doc.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            doc.addImage(multiples_and_journeys, 'PNG', 0, 0.75, pdfWidth, pdfHeight, "16", 'SLOW');
            doc.addPage("a4")
            });    

          var open_plan_lengths 
          html2canvas(document.getElementById("open_plan_lengths"), {scale: 2})
          .then(function (canvas) {
            doc.setFillColor(33,37,41);
            doc.rect(0, 0, 8.7, 11.7, 'F');
            doc.addImage(img, 'png', 0.5, 0.15, 0.175, 0.35, "17", 'SLOW') 
            doc.setFontSize(12)
            doc.setTextColor(255, 255, 255)
            doc.text("Data to Insight: SEND analysis tool", 5.5, 0.4)

            open_plan_lengths = canvas.toDataURL("image/png")
            const imgProps= doc.getImageProperties(open_plan_lengths);
            const pdfWidth = doc.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            doc.addImage(open_plan_lengths, 'PNG', 0, 0.75, pdfWidth, pdfHeight, "18", 'SLOW');
            doc.addPage("a4")
            });     

          var closed_plan_lengths 
          html2canvas(document.getElementById("closed_plan_lengths"), {scale: 2})
          .then(function (canvas) {
            doc.setFillColor(33,37,41);
            doc.rect(0, 0, 8.7, 11.7, 'F');
            doc.addImage(img, 'png', 0.5, 0.15, 0.175, 0.35, "19", 'SLOW') 
            doc.setFontSize(12)
            doc.setTextColor(255, 255, 255)
            doc.text("Data to Insight: SEND analysis tool", 5.5, 0.4)

            closed_plan_lengths = canvas.toDataURL("image/png")
            const imgProps= doc.getImageProperties(closed_plan_lengths);
            const pdfWidth = doc.internal.pageSize.getWidth();
            const pdfHeight = (imgProps.height * pdfWidth) / imgProps.width;
            doc.addImage(closed_plan_lengths, 'PNG', 0, 0.75, pdfWidth, pdfHeight);
            doc.save("SEND Report.pdf");
            $("#pdfSpinner").addClass('d-none');
            });    

          
          }
    </script>
</body>
</html>